<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>BFO Simulation</title>
<style>
    body {
        font-family: sans-serif;
        text-align: center;
        direction: rtl;
        padding: 10px;
        background: #f5f5f5;
    }

    #line-area {
        margin-top: 40px;
        width: 100%;
        height: 140px;
        position: relative;
    }

    .bacterium {
        width: 24px;
        height: 24px;
        background: #3498db;
        border-radius: 50%;
        position: absolute;
        top: 60px;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
        font-weight: bold;
    }

    #tree-area {
        margin-top: 60px;
    }

    svg {
        background: white;
        border-radius: 12px;
        box-shadow: 0 0 10px #ccc;
        width: 100%;
        max-width: 600px;
    }

    #controls {
        margin-top: 20px;
    }
</style>
</head>
<body>

<h2>شبیه‌ساز رفتار الگوریتم جستجوی باکتریایی (BFO)</h2>
<p>۵ باکتری به صورت همزمان روی محور حرکت می‌کنند تا به نقطه بهینه برسند.</p>

<div id="controls">
    سرعت:
    <input type="range" id="speed" min="100" max="2000" value="700">
    <button onclick="startSimulation()">شروع</button>
</div>

<div id="line-area"></div>

<h3>درخت مسیر حرکت</h3>
<div id="tree-area">
    <svg id="tree" width="600" height="400"></svg>
</div>

<script>
const positions = [0, 1, 2, 4, 5];
const bacteria = [];
const target = 3;

function createBacteria() {
    const area = document.getElementById("line-area");
    area.innerHTML = "";
    bacteria.length = 0;

    positions.forEach((x, i) => {
        const b = document.createElement("div");
        b.className = "bacterium";
        b.textContent = "B" + (i + 1);
        b.style.left = (x * 50) + "px";
        area.appendChild(b);

        bacteria.push({ element: b, x: x, history: [x] });
    });
}

function animateMovement(b, newX, speed) {
    return new Promise(resolve => {
        const interval = setInterval(() => {
            if (b.x < newX) b.x += 1;
            else if (b.x > newX) b.x -= 1;

            b.element.style.left = (b.x * 50) + "px";

            if (b.x === newX) {
                clearInterval(interval);
                resolve();
            }
        }, speed);
    });
}

async function runChemotaxis() {
    const speed = document.getElementById("speed").value;

    for (let step = 0; step < 4; step++) {
        for (let b of bacteria) {
            if (b.x < target) await animateMovement(b, b.x + 1, speed);
            else if (b.x > target) await animateMovement(b, b.x - 1, speed);

            b.history.push(b.x);
        }
    }
}

function drawTree() {
    const svg = document.getElementById("tree");
    svg.innerHTML = "";

    let y = 40;

    bacteria.forEach((b, idx) => {
        let x = 100;

        b.history.forEach((value, i) => {
            const cx = x + i * 70;
            const cy = y + idx * 60;

            // گره
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", cx);
            circle.setAttribute("cy", cy);
            circle.setAttribute("r", 20);
            circle.setAttribute("fill", "#2ecc71");
            svg.appendChild(circle);

            // عدد وسط گره (اصلاح شده)
            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", cx);
            text.setAttribute("y", cy + 4); 
            text.setAttribute("text-anchor", "middle"); 
            text.setAttribute("fill", "white");
            text.setAttribute("font-size", "16");
            text.textContent = value;
            svg.appendChild(text);

            // خط
            if (i > 0) {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", cx - 70);
                line.setAttribute("y1", cy);
                line.setAttribute("x2", cx);
                line.setAttribute("y2", cy);
                line.setAttribute("stroke", "#555");
                svg.appendChild(line);
            }
        });
    });
}

async function startSimulation() {
    createBacteria();
    await runChemotaxis();
    drawTree();
}
</script>

</body>
</html>
